{{#sticky-element top=navigationState.globalBarHeight}}
  <div class="row content-row header-row hidden-xs has-border">
    <h1 class="with-menu">
      <span class="one-label">
        {{tt this "members"}}
        {{#one-icon
          icon="settings"
          class=(concat-classes "view-tools-toggle" (if viewToolsVisible "active"))
          click=(action (mut viewToolsVisible) (not viewToolsVisible))}}
          {{one-tooltip title=(tt this (if viewToolsVisible "hideViewOptions" "showViewOptions"))}}
        {{/one-icon}}
      </span>
      <div class="btn-toolbar with-place-for-dots">
        {{#if batchEditAvailable}}
          {{#bs-button size="sm" onClick=(action "batchEdit") disabled=(not batchEditEnabled)}}
            {{tt this "multiedit"}}
          {{/bs-button}}
        {{/if}}
      </div>
      {{actions-toolbar isMinimized=true actionsArray=headerActions}}
    </h1>
  </div>
  {{#if viewToolsVisible}}
    <div class="view-tools row content-row has-border">
      {{#bs-button-group
        value=onlyDirect
        class="direct-selector view-mode-selector"
        type="radio"
        justified=media.isMobile
        onChange=(action (mut onlyDirect)) as |bg|
      }}
        <div class="btn-group" role="group">
          {{#bg.button type="default" class="btn-sm btn-direct" value=true}}
            {{tt this "direct"}}
            {{one-tooltip title="Direct" triggerEvents="hover"}}
          {{/bg.button}}
        </div>
        <div class="btn-group" role="group">
        {{#bg.button type="default" class="btn-sm btn-effecitve" value=false}}
            {{tt this "effective"}}
            {{one-tooltip title="Effective" triggerEvents="hover"}}
          {{/bg.button}}
        </div>
      {{/bs-button-group}}
      {{#bs-button-group
        value=aspect
        class="mode-selector view-mode-selector"
        type="radio"
        justified=media.isMobile
        onChange=(action (mut aspect)) as |bg|
      }}
        <div class="btn-group" role="group">
          {{#bg.button type="default" class="btn-sm btn-direct" value="privileges"}}
            {{tt this "privilegesAspect"}}
            {{one-tooltip title="Direct" triggerEvents="hover"}}
          {{/bg.button}}
        </div>
        <div class="btn-group" role="group">
          {{#bg.button type="default" class="btn-sm btn-effecitve" value="memberships"}}
            {{tt this "membershipsAspect"}}
            {{one-tooltip title="Effective" triggerEvents="hover"}}
          {{/bg.button}}
        </div>
      {{/bs-button-group}}
      {{#if (eq aspect "memberships")}}
        <div class="show-descriptions-toggle">
          {{one-way-toggle inputId="members-show-descriptions" checked=showDescription update=(action (mut showDescription))}}
          <label for="members-show-descriptions" class="inline-label">Show descriptions</label>
        </div>
      {{/if}}
    </div>
  {{/if}}
{{/sticky-element}}
{{#loading-container
  isLoading=(or groupList.isPending userList.isPending)
  errorReason=(or groupList.reason userList.reason)}}
  <div class="row">
    {{#members-collection
      aspect=aspect
      showDescription=showDescription
      contextRecord=record
      proxyList=proxyGroupRecordList
      subjectType="group"
      recordsSelected=(action "recordsSelected" "group")
      listHeader=(tt this "groups")
      itemIcon="groups"
      groupedPrivilegesFlags=groupedPrivilegesFlags
      privilegeGroupsTranslationsPath=privilegeGroupsTranslationsPath
      privilegesTranslationsPath=privilegesTranslationsPath
      save=(action "saveOne")
      collectionActions=groupListActions
      itemActions=groupActions as |list|}}
      {{#list.item as |listItem|}}
        {{#listItem.header
          class="text-center"
          disableToggleIcon=true
          isCollapsible=false
          hasCheckbox=false
          truncate=false}}
          <span class="one-label">
            {{tt this "noGroupsStart"}}
            <a {{action (mut inviteTokenModalType) "group"}}>{{tt this "noGroupsInvite"}}</a>
            {{tt this "noGroupsEnd"}}
          </span>
        {{/listItem.header}}
      {{/list.item}}
    {{/members-collection}}
  </div>
  <div class="row">
    {{#members-collection
      aspect=aspect
      showDescription=showDescription
      contextRecord=record
      proxyList=proxyUserRecordList
      subjectType="user"
      recordsSelected=(action "recordsSelected" "user")
      listHeader=(tt this "users")
      itemIcon="user"
      groupedPrivilegesFlags=groupedPrivilegesFlags
      privilegeGroupsTranslationsPath=privilegeGroupsTranslationsPath
      privilegesTranslationsPath=privilegesTranslationsPath
      save=(action "saveOne")
      collectionActions=userListActions
      itemActions=userActions as |list|}}
      {{#list.item as |listItem|}}
        {{#listItem.header
          class="text-center"
          disableToggleIcon=true
          isCollapsible=false
          hasCheckbox=false
          truncate=false}}
          <span class="one-label">
            {{tt this "noUsersStart"}}
            <a {{action (mut inviteTokenModalType) "user"}}>{{tt this "noUsersInvite"}}</a>
            {{tt this "noUsersEnd"}}
          </span>
        {{/listItem.header}}
      {{/list.item}}
    {{/members-collection}}
  </div>
{{/loading-container}}
{{privileges-editor-modal
  privilegesGroups=groupedPrivilegesFlags
  privilegeGroupsTranslationsPath=privilegeGroupsTranslationsPath
  privilegesTranslationsPath=privilegesTranslationsPath
  recordProxy=batchEditModalModel
  save=(action "saveBatch")
  close=(action "batchEditClose")
  opened=batchEditActive
  processing=batchEditModalModel.isSaving
  treeRootText=(tt this "batchEditModalSelectedItems")}}
{{join-as-user-modal
  opened=joinAsUserModalVisible
  close=(action (mut joinAsUserModalVisible) false)
  proceed=(action "join")
  processing=isJoiningAsUser
  modelType=record.entityType
  model=record}}
{{group-create-relative-modal
  opened=createChildGroupModalVisible
  close=(action (mut createChildGroupModalVisible) false)
  proceed=(action "createChildGroup")
  processing=isCreatingChildGroup
  relatedRecord=record
  relation=(if (eq record.entityType "group") "child" "member")}}
{{group-add-your-group-modal
  opened=addYourGroupModalVisible
  close=(action (mut addYourGroupModalVisible) false)
  proceed=(action "addYourGroup")
  processing=isAddingYourGroup
  relatedRecord=record
  relation=(if (eq record.entityType "group") "child" "member")}}
{{invite-using-token-modal
  opened=inviteTokenModalType
  close=(action (mut inviteTokenModalType) null)
  tokenType=inviteTokenModalType
  record=record}}
{{remove-relation-modal
  opened=(and memberToRemove (not memberToRemove.isDeleted))
  close=(action (mut memberToRemove) null)
  proceed=(action "removeMember")
  processing=isRemovingMember
  parent=record
  child=memberToRemove}}
{{yield}}
