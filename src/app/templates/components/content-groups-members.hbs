{{#sticky-element enabled=(not media.isTablet)}}
  <div class="row content-row header-row hidden-xs has-border">
    <h1 class="with-menu">
      <span class="one-label">
        {{tt this "members"}}
      </span>
      <div class="btn-toolbar with-place-for-dots">
        {{#bs-button class="btn btn-sm" onClick=(action "batchEdit") disabled=(not batchEditAvailable)}}Multiedit{{/bs-button}}
      </div>
      {{actions-toolbar isMinimized=true actionsArray=headerActions}}
    </h1>
  </div>
  {{#if visibleInvitationToken}}
    <div class="row content-row token-row has-border">
      <h1>
        <span class="one-label">{{tt this (concat visibleInvitationToken "InvitationToken")}}</span>
        {{one-icon icon="close" class="close-icon" click=(action "hideInvitationToken")}}
      </h1>
      {{#loading-container
        isLoading=invitationTokenProxy.isPending
        errorReason=invitationTokenProxy.reason
        sizeClass="sm"}}
        <div class="inner-row-content">
          <textarea class="token-textarea invitation-token form-control" rows="2" readonly>{{invitationTokenProxy.content}}</textarea>
          {{#copy-button
            success=(action "copyTokenSuccess")
            error=(action "copyTokenError")
            class="btn btn-sm btn-primary pull-left"
            clipboardTarget=".token-textarea.invitation-token"
          }}
            {{one-icon icon="clipboard-copy"}}
            {{tt this "copy"}}
          {{/copy-button}}
          <a class="clickable btn-get-token pull-right" {{action "generateInvitationToken"}}>{{tt this "generateToken"}}</a>
        </div>
      {{/loading-container}}
    </div>
  {{/if}}
{{/sticky-element}}
<div class="row">
  {{#loading-container
    isLoading=sharedGroupList.isPending
    errorReason=sharedGroupList.reason}}
    {{collection-permissions
      proxyList=proxySharedGroupList
      subjectType="group"
      modelsSelected=(action "modelsSelected" "group")
      listHeader=(tt this "groups")
      itemIcon="group"
      groupedPrivilegesFlags=groupedPrivilegesFlags
      privilegeGroupsTranslationsPath=(concat i18nPrefix ".privilegeGroups")
      privilegesTranslationsPath=(concat i18nPrefix ".privileges")
      save=(action "saveOne")}}
  {{/loading-container}}
</div>
<div class="row">
  {{#loading-container
    isLoading=sharedUserList.isPending
    errorReason=sharedUserList.reason}}
    {{collection-permissions
      proxyList=proxySharedUserList
      subjectType="user"
      modelsSelected=(action "modelsSelected" "user")
      listHeader=(tt this "users")
      itemIcon="user"
      groupedPrivilegesFlags=groupedPrivilegesFlags
      privilegeGroupsTranslationsPath=(concat i18nPrefix ".privilegeGroups")
      privilegesTranslationsPath=(concat i18nPrefix ".privileges")
      save=(action "saveOne")}}
  {{/loading-container}}
</div>
{{yield}}
{{#bs-modal
  open=batchEditActive
  onHide=(action "batchEditClose")
  class="batch-privileges-edit"
  as |modal|}}
  {{#modal.body}}
    {{#modal.header}}
      <h1>{{tt this "batchEditModalHeader"}}</h1>
    {{/modal.header}}
    <div class="tree-container">
      <div class="batch-edit-tree-title hidden-xs">{{one-icon icon="group"}}<span class="one-label">Selected items</span></div>
      {{privileges-tree-editor
        privilegesGroups=groupedPrivilegesFlags
        privilegeGroupsTranslationsPath=(concat i18nPrefix ".privilegeGroups")
        privilegesTranslationsPath=(concat i18nPrefix ".privileges")
        modelProxy=batchEditModalModel}}
    </div>
  {{/modal.body}}
  {{#modal.footer}}
    {{#bs-button class="btn btn-default" onClick=(action "batchEditClose")}}{{tt this "batchEditModalCancel"}}{{/bs-button}}
    {{#if batchEditModalModel.model.isFulfilled}}
      {{#one-spin-button
        class="btn btn-primary"
        action=(action "saveBatch")}}
        {{tt this "batchEditModalSave"}}
      {{/one-spin-button}}
    {{/if}}
  {{/modal.footer}}
{{/bs-modal}}
